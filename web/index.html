<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diet & Keep - 智能饮食与健康数据分析</title>
  <meta name="description" content="Diet & Keep 智能饮食与健康数据分析平台，帮助您追踪并优化日常饮食与健康数据。">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600&family=Patrick+Hand&display=swap"
    rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="css/styles.css">

  <style>
    /* === Login Page Container === */
    .login-page-wrapper {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      /* CSS-only warm paper background */
      background-color: #f8f4ec;
      background-image:
        radial-gradient(ellipse at 20% 10%, rgba(217, 119, 87, 0.15) 0%, transparent 45%),
        radial-gradient(ellipse at 80% 90%, rgba(224, 142, 115, 0.12) 0%, transparent 45%),
        radial-gradient(ellipse at 60% 40%, rgba(200, 180, 160, 0.08) 0%, transparent 50%);
    }

    .login-content-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 32px;
      max-width: 960px;
      width: 100%;
    }

    /* === Marketing Section (Left/Top) === */
    .marketing-section {
      width: 100%;
      text-align: center;
      color: #382e28;
      padding: 0 12px;
      box-sizing: border-box;
    }

    .brand-hero {
      margin-bottom: 24px;
    }

    .hero-logo {
      width: 72px;
      height: 72px;
      margin-bottom: 12px;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
      transform: rotate(-3deg);
    }

    .hero-title {
      font-family: 'Lora', serif;
      font-size: 2rem;
      font-weight: 600;
      color: #382e28;
      margin: 0 0 8px 0;
      line-height: 1.2;
    }

    .hero-subtitle {
      font-family: 'Patrick Hand', cursive;
      font-size: 1.15rem;
      color: #6e5d50;
      margin: 0;
      opacity: 0.9;
    }

    .features-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 24px;
      text-align: left;
      /* Mobile: Centered block */
      margin-left: auto;
      margin-right: auto;
      max-width: 360px;
    }

    .feature-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .feature-text h3 {
      font-family: 'Patrick Hand', cursive;
      font-size: 1.2rem;
      color: #d97757;
      font-weight: 600;
      margin: 0 0 4px 0;
    }

    .feature-text p {
      font-size: 0.875rem;
      margin: 0;
      padding-left: 2px;
      color: #7d6c5d;
      line-height: 1.4;
    }

    /* === Login Section (Right/Bottom) === */
    .login-section {
      width: 100%;
      display: flex;
      justify-content: center;
    }

    /* Main Login Card */
    .login-main-card {
      position: relative;
      width: 100%;
      max-width: 420px;
      /* Sized for Clerk card */
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(92, 85, 78, 0.15);
      border-radius: 20px;
      padding: 32px 24px;
      /* Reduced padding for mobile */
      box-shadow: 0 12px 40px rgba(74, 62, 53, 0.15);
      display: flex;
      flex-direction: column;
    }

    /* Washi Tape Decoration */
    .login-main-card::before {
      content: '';
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%) rotate(1deg);
      width: 90px;
      height: 26px;
      background: rgba(217, 119, 87, 0.35);
      opacity: 0.7;
      z-index: 10;
      border-radius: 2px;
    }

    /* Loading State */
    .login-loading {
      padding: 20px;
      text-align: center;
      min-height: 100px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .login-loading .loading-spinner {
      width: 28px;
      height: 28px;
      margin: 0 auto;
      border: 2px solid rgba(92, 85, 78, 0.15);
      border-top-color: #d97757;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .login-loading-text {
      margin-top: 16px;
      font-size: 0.9rem;
      color: #948171;
    }

    .login-prompt {
      text-align: center;
      font-family: 'Patrick Hand', cursive;
      font-size: 1.05rem;
      color: #6e5d50;
      margin: 0;
      letter-spacing: 0.02em;
    }

    /* === Demo Button === */
    .demo-entry {
      margin-top: 16px;
      text-align: center;
      padding-top: 16px;
      border-top: 1px dashed rgba(92, 85, 78, 0.1);
      position: relative;
      z-index: 5;
      /* Ensure clickable */
    }

    .btn-demo {
      background: transparent;
      border: 1px solid #d97757;
      color: #d97757;
      padding: 10px 20px;
      border-radius: 20px;
      font-family: inherit;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-demo .hand-icon {
      width: 16px;
      height: 16px;
    }

    .btn-demo:hover {
      background: rgba(217, 119, 87, 0.05);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(217, 119, 87, 0.1);
    }

    /* === Button Animations === */
    .btn-demo {
      position: relative;
      overflow: hidden;
      /* For shimmer containment */
    }

    /* Light Shimmer Effect */
    @keyframes shimmer {
      0% {
        transform: translateX(-120%) skewX(-20deg);
      }

      50% {
        transform: translateX(250%) skewX(-20deg);
      }

      /* Sweep across */
      100% {
        transform: translateX(250%) skewX(-20deg);
      }

      /* Stay off-screen for pause */
    }

    .btn-demo::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 40%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(217, 119, 87, 0.15), transparent);
      transform: translateX(-150%) skewX(-20deg);
      animation: shimmer 3s infinite ease-in-out;
      pointer-events: none;

      /* Paused by default, waits for js-loaded */
      animation-play-state: paused;
    }

    .btn-demo.js-loaded::after {
      animation-play-state: running;
    }

    /* Icon Pulse Animation */
    @keyframes icon-float {

      0%,
      100% {
        transform: translateY(0) scale(1.1);
      }

      50% {
        transform: translateY(-1px) scale(1.2);
      }
    }

    .btn-demo .demo-icon img {
      animation: icon-float 2s infinite ease-in-out;
      display: block;
      /* Remove baseline space */
      /* Paused by default */
      animation-play-state: paused;
    }

    .btn-demo.js-loaded .demo-icon img {
      animation-play-state: running;
    }

    /* === Clerk Style CSS Reset/Overrides === */
    /* 仅做必要的布局修复，避免 Clerk 默认容器挤压 */
    #clerk-auth {
      min-height: 180px;
      width: 100%;
    }

    /* 强制 Clerk 内部容器占满并保持纵向布局 */
    #clerk-auth .cl-card,
    #clerk-auth .cl-rootBox,
    #clerk-auth .cl-main,
    #clerk-auth .cl-cardBox {
      width: 100% !important;
      max-width: none !important;
      margin: 0 !important;
      align-items: center !important;
      box-shadow: none !important;
      border: none !important;
      background: transparent !important;
      display: flex !important;
      flex-direction: column !important;
      gap: 12px;
    }

    #clerk-auth .cl-form {
      gap: 12px;
    }

    /* 隐藏 Clerk 自带的标题 */
    #clerk-auth .cl-header,
    #clerk-auth .cl-headerTitle,
    #clerk-auth .cl-headerSubtitle {
      display: none !important;
    }

    /* === Compliance Footer === */
    .compliance-footer {
      margin-top: 20px;
      text-align: center;
      font-size: 0.75rem;
      color: #948171;
    }

    .compliance-footer a {
      color: #948171;
      text-decoration: none;
      margin: 0 6px;
      transition: color 0.2s;
    }

    .compliance-footer a:hover {
      color: #d97757;
    }

    /* === responsive === */
    /* Desktop */
    @media (min-width: 900px) {
      .login-content-container {
        flex-direction: row;
        align-items: flex-start;
        /* Align top */
        justify-content: center;
        gap: 80px;
        padding: 48px;
        max-width: 1100px;
      }

      .marketing-section {
        flex: 1;
        text-align: left;
        max-width: 400px;
        padding-top: 40px;
        /* Visual balance with card */
        padding-left: 0;
      }

      .features-list {
        margin-left: 0;
        align-items: flex-start;
      }

      .hero-title {
        font-size: 2.5rem;
      }

      .login-section {
        flex: 1;
        max-width: 420px;
      }
    }

    @media (max-width: 640px) {
      .login-main-card {
        padding: 20px 16px;
      }

      .login-prompt {
        margin: 0;
        font-size: 1rem;
      }

      .demo-entry {
        margin-top: 16px;
      }

      .btn-demo {
        padding: 10px 18px;
        font-size: 0.9rem;
      }

      .login-loading {
        min-height: 120px;
        padding: 12px;
      }

      #clerk-auth .cl-socialButtons,
      #clerk-auth .cl-socialButtonsBlock {
        display: flex !important;
        gap: 8px !important;
      }

    }
  </style>
</head>

<body>
  <div class="login-page-wrapper">
    <div class="login-content-container">

      <!-- Left: Marketing / "Why Me" -->
      <div class="marketing-section">
        <div class="brand-hero">
          <img src="css/icons/apple.png" class="hero-logo" alt="Diet & Keep Logo">
          <h1 class="hero-title">Diet & Keep</h1>
          <p class="hero-subtitle">你的 AI 营养师，懂热量更懂生活</p>
        </div>

        <div class="features-list">
          <div class="feature-item">
            <div class="feature-text">
              <h3>拍照即记</h3>
              <p>拍张照，AI 自动识别中餐热量与营养，告别繁琐查表。</p>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-text">
              <h3>动态分析</h3>
              <p>每餐之后，AI 都会为你更新营养报告和用餐建议。</p>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-text">
              <h3>全维追踪</h3>
              <p>联动体重与饮食数据，见证每一次健康改变。</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: Login Card -->
      <div class="login-section">
        <div class="login-main-card">
          <!-- Auth Container -->
          <p class="login-prompt">立即登录开始记录</p>
          <div class="login-clerk-wrapper">
            <div id="clerk-auth"></div>
            <div id="loading-state" class="login-loading">
              <div class="loading-spinner"></div>
              <p class="login-loading-text">正在唤醒 AI 助理...</p>
            </div>
          </div>

          <!-- Demo Entry -->
          <div class="demo-entry">
            <button class="btn-demo" onclick="window.location.href='dashboard.html?demo=true'">
              <span class="demo-icon"></span>
              不登录，先看看效果
            </button>
          </div>

          <!-- Compliance Footer -->
          <div class="compliance-footer">
            <a href="privacy.html" target="_blank">隐私政策</a>
            |
            <a href="terms.html" target="_blank">服务条款</a>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="config.js"></script>
  <!-- Render Demo Icon Immediately via Module -->
  <script type="module">
    import { IconManager } from './js/utils/icons.js';
    const demoIconSlot = document.querySelector('.btn-demo .demo-icon');
    if (demoIconSlot) {
      // update icon is 'sparkle.png', nice and noticeable
      demoIconSlot.innerHTML = IconManager.render('update');
    }
  </script>

  <script src="js/auth.js"></script>
  <script>
    // 动态加载 Clerk - 使用 CONFIG 中的 Key
    function loadClerk() {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.setAttribute('data-clerk-publishable-key', CONFIG.CLERK_PUBLISHABLE_KEY);
        script.src = 'https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js';
        script.async = true;
        script.crossOrigin = 'anonymous';

        script.onload = resolve;
        script.onerror = reject;

        document.head.appendChild(script);
      });
    }

    window.addEventListener('load', async () => {
      try {
        await loadClerk();
        await window.Clerk.load();

        document.getElementById('loading-state').style.display = 'none';

        if (window.Clerk.user) {
          window.location.href = 'dashboard.html';
          return;
        }

        // Clerk 加载完成后启用动效
        const demoBtn = document.querySelector('.btn-demo');
        if (demoBtn) demoBtn.classList.add('js-loaded');

        // Mount SignIn - Clerk 的 appearance API
        const signInDiv = document.getElementById('clerk-auth');
        if (signInDiv) {
          // 修复：移除导致布局崩坏的强制宽度和复杂覆盖，仅保留最小风格化
          window.Clerk.mountSignIn(signInDiv, {
            appearance: {
              variables: {
                colorPrimary: '#d97757', // 品牌色
                fontFamily: '"Lora", sans-serif',
              },
              layout: {
                shimmer: true, // 启用加载动画
                socialButtonsPlacement: 'top',
                showOptionalFields: false,
              },
              elements: {
                // 仅移除卡片背景，让它融入我们的磨砂玻璃容器，但不强制尺寸
                card: {
                  background: 'transparent',
                  boxShadow: 'none',
                  border: 'none',
                  width: '100%',
                  margin: 0,
                  padding: 0
                },
                rootBox: {
                  width: '100%'
                },
                // 隐藏标题，因为我们在外面有 "Diet & Keep"
                headerTitle: { display: 'none' },
                headerSubtitle: { display: 'none' },
                // 调整社交按钮布局
                socialButtonsBlockButton: {
                  borderRadius: '12px',
                  border: '1px solid rgba(92, 85, 78, 0.2)'
                },
                // 主按钮样式
                formButtonPrimary: {
                  background: 'linear-gradient(135deg, #d97757 0%, #e08e73 100%)',
                  borderRadius: '12px',
                  border: 'none',
                  fontSize: '0.95rem'
                },
                // 底部链接颜色
                footerActionLink: {
                  color: '#d97757'
                },
                // 社交登录按钮容器增加顶部间距（因为隐藏了 header）
                socialButtons: {
                  marginTop: '8px'
                }
              }
            }
          });
        }

        window.Clerk.addListener((r) => {
          if (r.user) window.location.href = 'dashboard.html';
        });

      } catch (error) {
        console.error('Clerk initialization failed:', error);
        const loadingState = document.getElementById('loading-state');
        if (loadingState) {
          loadingState.innerHTML = '<p style="color: #cd5c5c;">登录服务加载失败，请刷新页面重试</p>';
        }
      }
    });
  </script>
</body>

</html>