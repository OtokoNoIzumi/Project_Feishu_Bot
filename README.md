# é£ä¹¦æœºå™¨äºº

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„é£ä¹¦æœºå™¨äººé¡¹ç›®ï¼ŒåŸºäºæ¨¡å—åŒ–è¯­ä¹‰æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šåª’ä½“å¤„ç†ã€å®šæ—¶ä»»åŠ¡ã€HTTP APIç­‰åŠŸèƒ½ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

é‡‡ç”¨**è¯­ä¹‰åŒ–èŠ‚ç‚¹**çš„æ¨¡å—åŒ–æ¶æ„ï¼Œä¸»è¦æ¨¡å—èŠ‚ç‚¹ï¼š

### ğŸ¯ ä¸»æ¨¡å—èŠ‚ç‚¹
- **`main`**: åº”ç”¨å…¥å£ï¼Œè´Ÿè´£å¯åŠ¨æµç¨‹å’Œå®šæ—¶ä»»åŠ¡é…ç½®åŒ–ç®¡ç†
- **`app_controller`**: æœåŠ¡åè°ƒå™¨ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰æœåŠ¡ç”Ÿå‘½å‘¨æœŸå’Œå¥åº·çŠ¶æ€
- **`feishu_adapter`**: é£ä¹¦å¹³å°é€‚é…å™¨ï¼Œå¤„ç†æ¶ˆæ¯æ¥æ”¶ã€å‘é€å’Œæ ¼å¼è½¬æ¢

### ğŸ§© ä¸šåŠ¡å¤„ç†èŠ‚ç‚¹
**MessageProcessor**æš´éœ²çš„è¯­ä¹‰åŒ–å¤„ç†èŠ‚ç‚¹ï¼š
- **`message_processor.text`**: æ–‡æœ¬å¤„ç† (`get_help`, `greeting`, `default_reply`)
- **`message_processor.media`**: å¤šåª’ä½“å¤„ç† (`process_tts_async`, `sample_rich_text`, `sample_image`)
- **`message_processor.bili`**: Bç«™åŠŸèƒ½ (`video_menu`, `process_bili_video_async`)
- **`message_processor.admin`**: ç®¡ç†åŠŸèƒ½ (`handle_admin_command`, `handle_pending_operation_action`)
- **`message_processor.schedule`**: å®šæ—¶ä»»åŠ¡ (`create_task`, `daily_summary`, `bili_notification`)

### ğŸ”§ æœåŠ¡æ”¯æ’‘å±‚
é€šè¿‡`ServiceNames`å¸¸é‡åŒ–è®¿é—®ï¼š
- **Config**: é…ç½®ç®¡ç†ï¼Œæ”¯æŒ.envå’Œconfig.jsonä¼˜å…ˆçº§
- **Cache/PendingCache**: ç¼“å­˜ç®¡ç†å’Œå¾…å¤„ç†æ“ä½œç®¡ç†
- **Audio/Image**: å¤šåª’ä½“å¤„ç†æœåŠ¡
- **Scheduler**: é…ç½®åŒ–å®šæ—¶ä»»åŠ¡æœåŠ¡
- **Notion**: æ•°æ®æºé›†æˆ

### ğŸƒ å¡ç‰‡æ¶æ„è®¾è®¡

é¡¹ç›®é‡‡ç”¨**é…ç½®åŒ–å…³è”**çš„å¡ç‰‡æ¶æ„ï¼Œå®ç°ä¸šåŠ¡ä¸å¡ç‰‡çš„å½»åº•è§£è€¦ï¼š

#### æ ¸å¿ƒç†å¿µ
- **å¡ç‰‡å®šä½**: å¡ç‰‡æ˜¯é£ä¹¦Adapterçš„é™„å±ç‰¹æ€§ï¼Œæœ¬è´¨æ˜¯æ¶ˆæ¯çš„æ¥æ”¶ã€æ ‡å‡†æ ¼å¼åŒ–ã€å±•ç¤ºå’Œä¼ é€’å®¹å™¨
- **ä¸šåŠ¡è§£è€¦**: ä¸šåŠ¡å±‚ä¸å¡ç‰‡å±‚é€šè¿‡é…ç½®æ–‡ä»¶æ¡¥æ¥ï¼Œé¿å…ç¡¬ç¼–ç ä¾èµ–
- **ä¾èµ–æ–¹å‘**: å¡ç‰‡å¯ä»¥å‘ä¸‹è°ƒç”¨ä¸šåŠ¡å±‚ï¼Œä½†ä¸šåŠ¡å±‚ä¸èƒ½ä¾èµ–å¡ç‰‡

#### 3ä¸ªç‹¬ç«‹å¡ç‰‡ä¸šåŠ¡
1. **ç”¨æˆ·æ›´æ–°ç¡®è®¤å¡ç‰‡** (`admin_user_update_confirm`)
   - ç®¡ç†å‘˜ç”¨æˆ·çŠ¶æ€ç®¡ç†çš„ç¡®è®¤ç•Œé¢
   - æ”¯æŒç”¨æˆ·ç±»å‹é€‰æ‹©å’Œæ“ä½œç¡®è®¤

2. **å¹¿å‘Šæ›´æ–°ç¡®è®¤å¡ç‰‡** (`admin_ads_update_confirm`)
   - Bç«™å¹¿å‘Šæ—¶é—´æˆ³ç¼–è¾‘çš„ç¡®è®¤ç•Œé¢
   - æ”¯æŒæ—¶é—´æˆ³ç¼–è¾‘å™¨å’Œæ“ä½œç¡®è®¤

3. **Bç«™è§†é¢‘èœå•å¡ç‰‡** (`bili_video_menu`)
   - Bç«™è§†é¢‘æ¨èçš„äº¤äº’ç•Œé¢
   - æ”¯æŒ1+3æ¨èæ¨¡å¼å’Œå·²è¯»ç®¡ç†

#### é…ç½®åŒ–å…³è”æœºåˆ¶
```json
// cards_business_mapping.json - ä¸šåŠ¡å¡ç‰‡æ˜ å°„é…ç½®
{
  "business_mappings": {
    "update_user": {
      "response_type": "admin_card_send",
      "card_template": "admin_user_update_confirm",
      "timeout_seconds": 30,
      "actions": ["confirm_user_update", "cancel_user_update"]
    },
    "update_ads": {
      "response_type": "admin_ads_send",
      "card_template": "admin_ads_update_confirm",
      "timeout_seconds": 45,
      "actions": ["confirm_ads_update", "cancel_ads_update"]
    }
  }
}
```

#### å¿«é€Ÿæ’æ‹”æ”¯æŒ
- **æ–°å¢å¡ç‰‡**: ä»…éœ€åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ˜ å°„å…³ç³»ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 
- **æ¨¡æ¿çƒ­æ›´æ–°**: å¡ç‰‡æ¨¡æ¿å’Œé…ç½®æ”¯æŒé‡å¯åŠ è½½
- **æœ€å°å…¥ä¾µ**: æ–°å¡ç‰‡æ’æ‹”å¯¹ç°æœ‰ä¸šåŠ¡é›¶å½±å“

## âœ¨ ä¸»è¦åŠŸèƒ½

### ğŸ“± åŸºç¡€äº¤äº’
- æ–‡æœ¬å¯¹è¯å¤„ç†å’ŒæŒ‡ä»¤è·¯ç”±
- èœå•ç‚¹å‡»å“åº”å’Œå¡ç‰‡äº¤äº’
- å¯Œæ–‡æœ¬å¡ç‰‡æ”¯æŒå’ŒçŠ¶æ€ç®¡ç†
- å¼‚æ­¥ä»»åŠ¡å¤„ç†å’Œé”™è¯¯æ¢å¤

### ğŸ¨ å¤šåª’ä½“å¤„ç†
- **AIå›¾åƒç”Ÿæˆ**: åŸºäºæ–‡æœ¬æè¿°ç”Ÿæˆå›¾åƒ
- **å›¾åƒé£æ ¼è½¬æ¢**: ä¸Šä¼ å›¾ç‰‡è‡ªåŠ¨è½¬æ¢ä¸ºè´ºå¡é£æ ¼
- **TTSè¯­éŸ³åˆæˆ**: æ–‡æœ¬è½¬é«˜è´¨é‡ä¸­æ–‡è¯­éŸ³ï¼ˆCoze APIï¼‰
- **éŸ³é¢‘æ ¼å¼è½¬æ¢**: FFmpegè‡ªåŠ¨é€‚é…é£ä¹¦éŸ³é¢‘æ ¼å¼

### ğŸ“º Bç«™æ¨èç³»ç»Ÿ
- **1+3æ¨èæ¨¡å¼**: 1ä¸ªä¸»æ¨è + 3ä¸ªé¢å¤–æ¨è
- **æ™ºèƒ½å·²è¯»ç®¡ç†**: é¿å…é‡å¤æ¨è
- **å¤šç»´åº¦ç»Ÿè®¡åˆ†æ**: ä¼˜å…ˆçº§ã€æ—¶é•¿ã€æ¥æºã€ä½œè€…ç­‰
- **APIé›†æˆ**: æ”¯æŒå¤–éƒ¨Bç«™APIæ•°æ®æ›´æ–°

### â° å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ
- **é…ç½®åŒ–ç®¡ç†**: åŸºäºconfig.jsonçš„ä»»åŠ¡é…ç½®ï¼Œæ”¯æŒå¯ç”¨/ç¦ç”¨
- **è°ƒè¯•æ¨¡å¼**: `force_latest_time`å¼€å…³ï¼Œè‡ªåŠ¨è°ƒæ•´ä»»åŠ¡æ—¶é—´ä¸ºå¯åŠ¨æ—¶é—´+5ç§’
- **ä»»åŠ¡ç±»å‹**: æ”¯æŒ`daily_schedule`ï¼ˆæ¯æ—¥æ±‡æ€»ï¼‰å’Œ`bilibili_updates`ï¼ˆBç«™æ›´æ–°ï¼‰
- **çµæ´»å‚æ•°**: æ¯ä¸ªä»»åŠ¡å¯é…ç½®ç‹¬ç«‹çš„å‚æ•°ï¼ˆå¦‚Bç«™æ•°æ®æºï¼‰
- **ç»Ÿä¸€å¤„ç†**: `schedule.create_task()`å°è£…æ‰€æœ‰è·¯ç”±é€»è¾‘

### ğŸŒ HTTP APIæ¥å£
- **RESTful API**: å®Œæ•´çš„HTTPæ¥å£æ”¯æŒ
- **å®‰å…¨é‰´æƒ**: IPç™½åå• + å¯†é’¥åŒé‡éªŒè¯
- **Swaggeræ–‡æ¡£**: è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£ `/docs`
- **ç‹¬ç«‹éƒ¨ç½²**: å¯ä¸ä¸»æœåŠ¡å…±äº«æˆ–ç‹¬ç«‹è¿è¡Œ

### ğŸ” è®¤è¯ä¸ç®¡ç†
- **åŠ¨æ€é…ç½®æ›´æ–°**: æ— éœ€é‡å¯çš„è®¤è¯å‚æ•°æ›´æ–°
- **ç®¡ç†å‘˜åŠŸèƒ½**: ç”¨æˆ·çŠ¶æ€ç®¡ç†ã€é…ç½®æ›´æ–°ã€å¹¿å‘Šä¿¡æ¯ç»´æŠ¤
- **çŠ¶æ€ç›‘æ§**: å®æ—¶æŸ¥è¯¢æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€
- **æ“ä½œç¡®è®¤**: ç®¡ç†å‘˜æ“ä½œçš„å®‰å…¨ç¡®è®¤æœºåˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.11+
- Anacondaè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èWorkSpaceç¯å¢ƒï¼‰
- é£ä¹¦æœºå™¨äººåº”ç”¨é…ç½®

### å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### é…ç½®è®¾ç½®
1. **ç¯å¢ƒå˜é‡é…ç½®** (`.env`)ï¼š
   - `FEISHU_APP_ID` / `FEISHU_APP_SECRET` - é£ä¹¦æœºå™¨äººå¯†é’¥
   - `ADMIN_ID` - ç®¡ç†å‘˜ç”¨æˆ·IDï¼ˆå¿…éœ€ï¼‰
   - `GRADIO_BASE_URL` / `COZE_API_KEY` - å¤šåª’ä½“æœåŠ¡é›†æˆ
   - `NOTION_*` - æ•°æ®æºé…ç½®
   - `ADMIN_SECRET_KEY` - HTTP APIç®¡ç†å¯†é’¥

2. **åº”ç”¨é…ç½®** (`config.json`)ï¼š
   - `scheduler.tasks[]` - å®šæ—¶ä»»åŠ¡é…ç½®æ•°ç»„
   - `pending_cache` - æ“ä½œè¶…æ—¶å’Œç¼“å­˜é…ç½®
   - `cards` - å¡ç‰‡æ¨¡æ¿å’Œå›å¤æ¨¡å¼é…ç½®

3. **ä¸šåŠ¡é…ç½®** (`cards_business_mapping.json`)ï¼š
   - å¡ç‰‡ä¸ä¸šåŠ¡çš„æ˜ å°„å…³ç³»
   - æ”¯æŒçƒ­æ›´æ–°å’Œæ’æ‹”å¼é…ç½®

### å¯åŠ¨æœåŠ¡

#### Windowsä¸€é”®å¯åŠ¨
```bash
start.bat
```

#### å‘½ä»¤è¡Œå¯åŠ¨
```bash
# æ ‡å‡†å¯åŠ¨ï¼ˆé£ä¹¦æœºå™¨äººï¼‰
python main.py

# å¸¦APIéªŒè¯å¯åŠ¨
python main.py --verify-api

# å¯åŠ¨HTTP APIæœåŠ¡å™¨
python main.py --http-api --http-port 8000

# å®Œæ•´åŠŸèƒ½å¯åŠ¨
python main.py --verify-api --http-api
```

#### Jupyterç¯å¢ƒï¼ˆå¼€å‘è°ƒè¯•ï¼‰
```python
# åœ¨WorkSpaceè™šæ‹Ÿç¯å¢ƒä¸­
await main_async()
```

## ğŸ“ ä½¿ç”¨è¯´æ˜

### åŸºç¡€æŒ‡ä»¤
- `å¸®åŠ©` - æŸ¥çœ‹å®Œæ•´åŠŸèƒ½åˆ—è¡¨
- `é…éŸ³ æ–‡æœ¬å†…å®¹` - TTSè¯­éŸ³åˆæˆ
- `ç”Ÿå›¾ æè¿°` - AIå›¾åƒç”Ÿæˆ
- `å¯Œæ–‡æœ¬` - å¯Œæ–‡æœ¬æ ¼å¼æ¼”ç¤º
- å‘é€å›¾ç‰‡ - è‡ªåŠ¨å›¾åƒé£æ ¼è½¬æ¢

### Bç«™åŠŸèƒ½
- `Bç«™` æˆ– `è§†é¢‘` - è·å–è§†é¢‘æ¨è
- èœå•ç‚¹å‡»"Bç«™" - è·å–1+3æ¨¡å¼æ¨è
- å¡ç‰‡æŒ‰é’®æ“ä½œ - æ ‡è®°å·²è¯»ã€è·å–æ›´å¤š

### ç®¡ç†å‘˜åŠŸèƒ½ï¼ˆéœ€ç®¡ç†å‘˜æƒé™ï¼‰
- `whiskä»¤ç‰Œ cookies æ–°å€¼` - æ›´æ–°è®¤è¯é…ç½®
- `æ›´æ–°ç”¨æˆ· ç”¨æˆ·ID ç±»å‹` - ç”¨æˆ·çŠ¶æ€ç®¡ç†
- `æ›´æ–°å¹¿å‘Š BVID æ—¶é—´æˆ³` - Bç«™å¹¿å‘Šä¿¡æ¯æ›´æ–°

## ğŸ”§ é…ç½®è¯´æ˜

### é…ç½®æ¶æ„
- **è®¤è¯é…ç½®**: é€šè¿‡GradioæœåŠ¡åŸç”ŸAPIå¤„ç†ï¼ˆæ— éœ€æœ¬åœ°æ–‡ä»¶ï¼‰
- **åº”ç”¨é…ç½®ä¼˜å…ˆçº§**: ç¯å¢ƒå˜é‡(.env) > é™æ€é…ç½®(config.json) > æœåŠ¡é»˜è®¤å€¼
- **å¡ç‰‡é…ç½®**: ä¸šåŠ¡å¡ç‰‡æ˜ å°„é…ç½®(cards_business_mapping.json)

### é‡è¦é…ç½®é¡¹
- **é£ä¹¦é…ç½®**: APP_IDã€APP_SECRETã€ADMIN_ID
- **æœåŠ¡é›†æˆ**: GRADIO_BASE_URLã€COZE_API_KEYã€BOT_ID
- **æ•°æ®æº**: Notionæ•°æ®åº“é…ç½®ã€Bç«™APIé…ç½®
- **å®‰å…¨è®¾ç½®**: ADMIN_SECRET_KEYã€BILI_NIGHT_SILENT

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
Project_Feishu_Bot/
â”œâ”€â”€ Module/                              # ğŸ—ï¸ æ ¸å¿ƒæ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ Adapters/                        # é€‚é…å™¨å±‚ï¼ˆé£ä¹¦å¹³å°äº¤äº’ï¼‰
â”‚   â”œâ”€â”€ Business/                        # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆæ¶ˆæ¯å¤„ç†ï¼‰
â”‚   â”œâ”€â”€ Application/                     # åº”ç”¨æ§åˆ¶å±‚ï¼ˆæœåŠ¡ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ Services/                        # æœåŠ¡å±‚ï¼ˆåŠŸèƒ½å®ç°ï¼‰
â”‚   â””â”€â”€ Common/                          # å…¬å…±å·¥å…·å’Œè„šæœ¬
â”œâ”€â”€ config.json                          # âš™ï¸ é™æ€é…ç½®æ–‡ä»¶
â”œâ”€â”€ cards_business_mapping.json          # ğŸƒ å¡ç‰‡ä¸šåŠ¡æ˜ å°„é…ç½®
â”œâ”€â”€ README.md                            # ğŸ“– é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ TECHNICAL_ARCHITECTURE_REFERENCE.md  # ğŸ“š æŠ€æœ¯æ¶æ„å‚è€ƒæ–‡æ¡£
â”œâ”€â”€ CHANGELOG.md                         # ğŸ“‹ é¡¹ç›®å˜æ›´æ—¥å¿—
â””â”€â”€ DEVELOPMENT_TIL.md                   # ğŸ’¡ å¼€å‘è€…ä»Šæ—¥å­¦ä¹ 
```

### æ–‡æ¡£è¯´æ˜
- **README.md**: é¡¹ç›®æ¦‚è§ˆã€å¿«é€Ÿå¼€å§‹å’Œä½¿ç”¨æŒ‡å—
- **TECHNICAL_ARCHITECTURE_REFERENCE.md**: è¯¦ç»†çš„æŠ€æœ¯æ¶æ„è®¾è®¡å’Œå®æ–½æ–¹æ¡ˆ
- **CHANGELOG.md**: ç‰ˆæœ¬å˜æ›´è®°å½•å’Œé¡¹ç›®å‘å±•å†ç¨‹
- **DEVELOPMENT_TIL.md**: å¼€å‘è¿‡ç¨‹ä¸­çš„æ¯æ—¥å­¦ä¹ å’ŒæŠ€æœ¯å‘ç°

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `Services/` ä¸‹å®ç°æ–°æœåŠ¡ï¼Œå¿…é¡»å®ç° `get_status()` æ–¹æ³•
2. åœ¨å¯¹åº” `Processor` ä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘
3. é€šè¿‡ `AppController` æ³¨å†ŒæœåŠ¡
4. å¯é€‰ï¼šæ·»åŠ HTTP APIæ¥å£

### å¼€å‘è§„èŒƒ
- **ç†è§£ä¼˜å…ˆ**: å……åˆ†ç†è§£ç°æœ‰é€»è¾‘åå†ä¿®æ”¹
- **ç»Ÿä¸€æ—¥å¿—**: æ­£å¼åŠŸèƒ½ä½¿ç”¨ `debug_utils` è®°å½•æ‰€æœ‰æ—¥å¿—ï¼Œå¼€å‘é˜¶æ®µçš„åŠŸèƒ½éœ€è¦ç»™æ—¥å¿—ä¸€äº›æ–¹ä¾¿æœç´¢å®šä½çš„ç‰¹æ®Šæ ‡è®°ï¼Œæ¯”å¦‚'test-',æˆ–è€…"âš ï¸âš ï¸âš ï¸"ï¼Œåœ¨éªŒæ”¶å®ŒæˆåæŠŠæµ‹è¯•æ—¥å¿—å’Œæ–°æ—¥å¿—é‡Œçš„æ ‡è®°ç§»é™¤
- **ä¼˜é›…å¼‚å¸¸**: æä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯å’Œé™çº§æ–¹æ¡ˆ
- **è·¯å¾„è§„èŒƒ**: æ‰€æœ‰é…ç½®æ–‡ä»¶è·¯å¾„åŸºäºé¡¹ç›®æ ¹ç›®å½•
- **é¿å…è¯•é”™**: éªŒè¯å¤±è´¥æ—¶åœæ­¢å°è¯•ï¼Œç­‰å¾…ç”¨æˆ·æŒ‡å¯¼

## ğŸ—“ï¸ å¼€å‘è®¡åˆ’

### è¿‘æœŸä¼˜åŒ–
1. **Bç«™åŠŸèƒ½å¢å¼º**
   - æ”¯æŒæŒ‰æ—¶é—´ç­›é€‰å’Œæ‰¹é‡æ“ä½œ
   - å¢åŠ å…¨éƒ¨å·²è¯»ã€éšæœºæ¨èåŠŸèƒ½
   - LLMé©±åŠ¨çš„æ™ºèƒ½è·¯ç”±å’Œå‚æ•°é‡ç°

2. **äº¤äº’ä½“éªŒæå‡**
   - è¯­éŸ³è¾“å…¥è¯†åˆ«å’ŒTTSæ’­æŠ¥è”åŠ¨
   - æ¶ˆæ¯å›å¤å’Œè¯„è®ºè¯†åˆ«ä¼˜åŒ–
   - ä¸Šä¸‹æ–‡åˆ‡æ¢æŒ‰é’®å’Œè‡ªåŠ¨æ£€æµ‹

3. **ç³»ç»Ÿæ•´åˆæ‰©å±•**
   - é“¾æ¥è¯»å–å’Œæ–‡æ¡£å¤„ç†åŠŸèƒ½
   - å¤–å–å†³ç­–å’Œæ—¶é—´è®°å½•æ¨¡å—
   - å¤©æ°”ä¿¡æ¯å’Œç©¿è¡£å»ºè®®é›†æˆ

### æŠ€æœ¯æ¶æ„
- **è·¯ç”±æ³›åŒ–**: ä½¿ç”¨LLMé©±åŠ¨çš„é€šç”¨åŠŸèƒ½è°ƒç”¨
- **å¡ç‰‡ç³»ç»Ÿ**: ç»Ÿä¸€çš„æ¨¡æ¿ç®¡ç†å’Œäº¤äº’ç»„ä»¶
- **æ•°æ®ç®¡ç†**: å¯æ’¤é”€ç¼“å­˜å’ŒNotioné›†æˆä¼˜åŒ–
- **MCPæ ‡å‡†**: å¤šé€šé“å¹³å°é›†æˆæ–¹æ¡ˆ

## è®¸å¯è¯

MIT License

## ä¸€äº›å¤‡å¿˜

æ£€æŸ¥å¯Œæ–‡æœ¬çš„æ¶ˆæ¯ï¼Ÿâ€”message_typeä¸ºpostï¼Œæ„Ÿè§‰å¯ä»¥å…ˆä¸å»è§£æ
2025-06-22 15:46:32,661 DEBUG { 'challenge': None,
  'event': { 'message': { 'chat_id': 'oc_00da7eba51fbc1fdcf5cf40ab332bf7e',
                          'chat_type': 'p2p',
                          'content': '{"title":"å†™ä¸ªå°ä½œæ–‡","content":[[{"tag":"text","text":"é‡æ–°åˆ·æ–°prompt","style":[]}],[{"tag":"img","image_key":"img_v3_02ng_f530c621-511e-4155-885f-84327da9255g","width":850,"height":1188}]]}',
                          'create_time': '1750578393311',
                          'mentions': None,
                          'message_id': 'om_x100b4a4f035f60b80f37721ad0ea286',
                          'message_type': 'post',
                          'parent_id': None,
                          'root_id': None,
                          'thread_id': None,
                          'update_time': '1750578393311',
                          'user_agent': None},
             'sender': { 'sender_id': { 'open_id': 'ou_08158e2f511912a18063fc6072ce42da',
                                        'union_id': 'on_f30d6f403ec60cad71c6c9c1e1da1ce0',
                                        'user_id': None},
                         'sender_type': 'user',
                         'tenant_key': '101c4da96edf975e'}},
  'header': { 'app_id': 'cli_a6bf8e1105de900b',
              'create_time': '1750578393583',
              'event_id': 'e076931bdbe7eda2f26c0bafe475c7c7',
              'event_type': 'im.message.receive_v1',
              'tenant_key': '101c4da96edf975e',
              'token': ''},
  'schema': '2.0',
  'token': None,
  'ts': None,
  'type': None,
  'uuid': None}

pinå’Œç½®é¡¶æ²¡æ¶ˆæ¯

ä»»åŠ¡æ˜¯ä¸€ä¸ªæ¶ˆæ¯ï¼Œç‚¹å‡»å®Œæˆä»»åŠ¡ä¸æ˜¯æ¶ˆæ¯
2025-06-22 15:53:30,857 DEBUG ğŸ” P2ImMessageReceiveV1å¯¹è±¡è¯¦ç»†ä¿¡æ¯ (pprint):
2025-06-22 15:53:30,857 DEBUG { 'challenge': None,
  'event': { 'message': { 'chat_id': 'oc_00da7eba51fbc1fdcf5cf40ab332bf7e',
                          'chat_type': 'p2p',
                          'content': '{"task_id":"96dba4b6-1fe7-4ce4-abd5-fbdf7344671a","summary":{"title":"","content":[[{"tag":"text","text":"å¢åŠ å¡ç‰‡å¯¼å…¥","style":[]}]]},"due_time":"1750550400000"}',
                          'create_time': '1750578811485',
                          'mentions': None,
                          'message_id': 'om_x100b4a4f29785fe40f38a30d3d08f8e',
                          'message_type': 'todo',
                          'parent_id': None,
                          'root_id': None,
                          'thread_id': None,
                          'update_time': '1750578811485',
                          'user_agent': None},
             'sender': { 'sender_id': { 'open_id': 'ou_08158e2f511912a18063fc6072ce42da',
                                        'union_id': 'on_f30d6f403ec60cad71c6c9c1e1da1ce0',
                                        'user_id': None},
                         'sender_type': 'user',
                         'tenant_key': '101c4da96edf975e'}},
  'header': { 'app_id': 'cli_a6bf8e1105de900b',
              'create_time': '1750578811799',
              'event_id': 'bb8c2ecdde189373ecb4d0d04c97fbbc',
              'event_type': 'im.message.receive_v1',
              'tenant_key': '101c4da96edf975e',
              'token': ''},
  'schema': '2.0',
  'token': None,
  'ts': None,
  'type': None,
  'uuid': None}
2025-06-22 15:53:30,857 DEBUG   - å…³é”®ä¿¡æ¯: æ­¤æ¶ˆæ¯éå›å¤æ¶ˆæ¯ (parent_id is None or empty)