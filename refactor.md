# èœå•è®°å½•åŠŸèƒ½æ‰©å±•é‡æ„æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### æ ¸å¿ƒç›®æ ‡
æ‰©å±•èœå•è§¦å‘çš„å¡ç‰‡è®°å½•åŠŸèƒ½ï¼Œæ”¯æŒåœ¨æ²¡æœ‰äº‹ä»¶å®šä¹‰çš„æƒ…å†µä¸‹ç›´æ¥æ·»åŠ è®°å½•ã€‚

### è®¾è®¡åŸåˆ™
1. **ä¿ç•™ç°æœ‰é€»è¾‘**ï¼šæ—§çš„recordæ–¹æ³•å®Œå…¨ä¿ç•™ï¼Œé¿å…å½±å“ç°æœ‰åŠŸèƒ½
2. **æ¸è¿›å¼å¼€å‘**ï¼šåˆ†MVPé˜¶æ®µå®ç°ï¼Œæ•°æ®ç»“æ„ä¸€æ¬¡æ€§è§„åˆ’åˆ°ä½
3. **ç±»å‹é©±åŠ¨**ï¼šä»¥äº‹ä»¶ç±»å‹ä¸ºæ ¸å¿ƒï¼ŒåŠ¨æ€æ˜¾ç¤ºç›¸åº”å­—æ®µ
4. **å®¹å™¨æ¨¡å¼å…¼å®¹**ï¼šä¸ç°æœ‰é›†æˆæ¨¡å¼æ¶æ„ä¿æŒä¸€è‡´

## âœ… å·²å®ŒæˆåŠŸèƒ½

### ç›´æ¥è®°å½•æ ¸å¿ƒåŠŸèƒ½
- **ä¸šåŠ¡å±‚å®ç°**ï¼š`routine_record.py` ä¸­çš„ `create_direct_record` æ–¹æ³•
- **é€‚é…å™¨å±‚å®ç°**ï¼š`direct_record_card.py` å®Œæ•´å¡ç‰‡åŠŸèƒ½
- **äº‹ä»¶å®šä¹‰è‡ªåŠ¨åˆ›å»º**ï¼šé `future` ç±»å‹äº‹é¡¹è‡ªåŠ¨åˆ›å»ºäº‹ä»¶å®šä¹‰
- **æ—¶é—´æ ¼å¼æ”¯æŒ**ï¼šæ”¯æŒå¸¦æ—¶åŒºçš„æ—¶é—´æ ¼å¼éªŒè¯
- **UIä¼˜åŒ–**ï¼šé¢„ä¼°è€—æ—¶å’Œå¤‡æ³¨å­—æ®µç§»è‡³æŠ˜å é¢æ¿

### æ ¸å¿ƒæ–¹æ³•ç´¢å¼•
- `RoutineRecord.create_direct_record()` - åˆ›å»ºç›´æ¥è®°å½•
- `RoutineRecord._create_event_definition_from_direct_record()` - è‡ªåŠ¨åˆ›å»ºäº‹ä»¶å®šä¹‰
- `DirectRecordCard.build_direct_record_card()` - æ„å»ºç›´æ¥è®°å½•å¡ç‰‡
- `DirectRecordCard.confirm_direct_record()` - ç¡®è®¤è®°å½•æäº¤

## ğŸ—ï¸ æ•°æ®ç»“æ„è®¾è®¡

### ç›´æ¥è®°å½•æ•°æ®ç»“æ„â€”â€”å‚¨å­˜åœ¨event_records.jsonï¼Œå’ŒåŸæœ‰æ•°æ®ä¸åšåŒºåˆ†
```json
{
  "record_id": "äº‹ä»¶å_001", // æ ¹æ®äº‹ä»¶åç”Ÿæˆ
  "event_name": "ç”¨æˆ·è¾“å…¥çš„äº‹ä»¶å",
  "event_type": "instant|start|ongoing|future",
  "timestamp": "2024-01-01 12:00:00",
  "completion_time": "2024-01-01 12:05:00",
  
  // å…¬å…±å­—æ®µ
  "note": "å¤‡æ³¨å†…å®¹",
  "degree": "å®Œæˆæ–¹å¼",
  "duration": 5.0,
  
  // æŒ‡æ ‡ç›¸å…³
  "progress_type": "none|value|modify",
  "progress_value": 1.0,
  
  // é•¿æœŸé¡¹ç›®ç‰¹æœ‰â€”â€”æˆ–è€…é€šè¿‡åç»­çš„äº‹ä»¶å®šä¹‰è·å¾—ï¼Œæ¯”å¦‚ç¬é—´å®Œæˆçš„åˆ·ç‰™ä¹Ÿæœ‰è¿™ä¸ªå±æ€§ã€‚
  "check_cycle": "",  // åˆæ³•å€¼ RoutineCheckCycle
  "target_type": "none|time|count",
  "target_value": 10,
}
```

### äº‹ä»¶ç±»å‹æ”¯æŒèŒƒå›´
- âœ… **ç¬é—´å®Œæˆ (instant)**ï¼šé»˜è®¤é€‰æ‹©
- âœ… **å¼€å§‹äº‹é¡¹ (start)**ï¼šå¯é€‰æ‹©
- âŒ **ç»“æŸäº‹é¡¹ (end)**ï¼šæ’é™¤ï¼Œé™å®šä¸ºå¯¹å¼€å§‹çš„ç»“æŸ
- âœ… **é•¿æœŸæŒç»­ (ongoing)**ï¼šå¯é€‰æ‹©
- âœ… **æœªæ¥äº‹é¡¹ (future)**ï¼šå¯é€‰æ‹©

## ğŸš€ å¼€å‘è¿›å±•

### âœ… å·²å®Œæˆé˜¶æ®µ

#### é˜¶æ®µ1-6ï¼šåŸºç¡€æ¶æ„åˆ°æ•°æ®å¤„ç† (å·²å®Œæˆ)
- **ä¸šåŠ¡å±‚**ï¼š`RoutineRecord.create_direct_record()` æ–¹æ³•å®Œæ•´å®ç°
- **é€‚é…å™¨å±‚**ï¼š`DirectRecordCard` ç±»å®Œæ•´å®ç°ï¼Œæ”¯æŒæ‰€æœ‰äº‹ä»¶ç±»å‹
- **æ•°æ®éªŒè¯**ï¼šæ—¶é—´æ ¼å¼éªŒè¯ï¼Œæ”¯æŒå¸¦æ—¶åŒºæ ¼å¼
- **äº‹ä»¶å®šä¹‰**ï¼šè‡ªåŠ¨åˆ›å»ºæœºåˆ¶ï¼Œç»Ÿè®¡ä¿¡æ¯ç»´æŠ¤
- **UIäº¤äº’**ï¼šç±»å‹åˆ‡æ¢ã€å­—æ®µåŠ¨æ€æ˜¾ç¤ºã€è¡¨å•æäº¤
- **é›†æˆç‚¹**ï¼šä¸ `quick_select_card` çš„æ— ç¼é›†æˆ

### ğŸ”„ å½“å‰å¼€å‘é‡ç‚¹

#### æ´—é¢å¥¶ä½¿ç”¨è¿½è¸ªåœºæ™¯ä¼˜åŒ–
åŸºäºç”¨æˆ·æå‡ºçš„æ´—é¢å¥¶ä½¿ç”¨è¿½è¸ªåœºæ™¯ï¼Œæ­£åœ¨è§„åˆ’ä»¥ä¸‹æ¶æ„ä¼˜åŒ–ï¼š

**æ ¸å¿ƒé—®é¢˜è§£å†³**ï¼š
- **è®¤çŸ¥è´Ÿè·**ï¼šç®€åŒ–äº‹ä»¶åç§°è®¾å®šï¼Œé€šè¿‡ç›´è§‰åŒ–æ“ä½œè®°å½•
- **ä¿¡æ¯å™ªéŸ³**ï¼šé€šè¿‡ `active_records` ç´¢å¼•åŒç±»å‹äº‹ä»¶ï¼Œå‡å°‘é‡å¤è¾“å…¥
- **å…³è”è¿½è¸ª**ï¼šå®ç°çˆ¶å­äº‹ä»¶å…³è”ï¼Œå½¢æˆå®Œæ•´ä¸šåŠ¡å‘¨æœŸ

**æŠ€æœ¯å®ç°æ–¹å‘**ï¼š
- `records` å’Œ `active_records` æ”¹ä¸º `OrderedDict` å­˜å‚¨
- `query_results_card` å¢åŠ å·¥ä½œæµæŒ‰é’®ï¼ˆè®°å½•è¿›åº¦ã€å®Œæˆäº‹é¡¹ã€æŸ¥çœ‹å†å²ï¼‰
- æ™ºèƒ½å…³è”æœºåˆ¶å’Œé¢„å¡«å……ç­–ç•¥
- ä¸€é”®æµè½¬åŠŸèƒ½ï¼Œé¢„å¡«å……å­—æ®µå’Œå…³è”äº‹ä»¶ç±»å‹

### é˜¶æ®µ3-5ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆå·²å®Œæˆï¼‰

#### å·²å®ç°åŠŸèƒ½æ¦‚è§ˆ
- **ç¬é—´å®Œæˆå’Œå¼€å§‹ç±»å‹**ï¼šæ”¯æŒè€—æ—¶ã€å®Œæˆæ–¹å¼ã€å¤‡æ³¨ã€æŒ‡æ ‡å€¼è®°å½•
- **é•¿æœŸé¡¹ç›®ç±»å‹**ï¼šæ”¯æŒé—´éš”ç±»å‹ã€ç›®æ ‡è®¾ç½®ã€æŒ‡æ ‡è¿½è¸ª
- **æœªæ¥äº‹é¡¹ç±»å‹**ï¼šæ”¯æŒæ—¥æœŸæ—¶é—´ã€é‡è¦æ€§ã€æé†’è®¾ç½®
- **åŠ¨æ€è¡¨å•**ï¼šæ ¹æ®äº‹ä»¶ç±»å‹å’ŒæŒ‡æ ‡ç±»å‹åŠ¨æ€æ˜¾ç¤ºå­—æ®µ
- **çŠ¶æ€ä¿æŒ**ï¼šç±»å‹åˆ‡æ¢æ—¶ä¿ç•™å·²è¾“å…¥æ•°æ®
- **æ•°æ®æäº¤**ï¼šå®Œæ•´çš„è¡¨å•éªŒè¯å’Œè®°å½•åˆ›å»ºæµç¨‹





## ğŸš€ æœªæ¥æ•´åˆè§„åˆ’

### æ´—é¢å¥¶åœºæ™¯æ¶æ„ä¼˜åŒ–

#### æ•°æ®ç»“æ„ä¼˜åŒ–
- **OrderedDict å­˜å‚¨**ï¼š`records` å’Œ `active_records` æ”¹ä¸ºæœ‰åºå­—å…¸
- **å…³è”æœºåˆ¶**ï¼šæ”¯æŒçˆ¶å­äº‹ä»¶å…³è”ï¼Œå½¢æˆå®Œæ•´ä¸šåŠ¡å‘¨æœŸ
- **æ™ºèƒ½ç´¢å¼•**ï¼šé€šè¿‡ `active_records` å¿«é€Ÿå®šä½åŒç±»å‹äº‹ä»¶

#### å·¥ä½œæµæŒ‰é’®è®¾è®¡
åœ¨ `query_results_card` ä¸­å¢åŠ ï¼š
- **è®°å½•è¿›åº¦**ï¼šå¿«é€Ÿè®°å½•å½“å‰çŠ¶æ€ï¼ˆå¦‚æ£€æŸ¥å‰©ä½™é‡ï¼‰
- **å®Œæˆäº‹é¡¹**ï¼šæ ‡è®°äº‹é¡¹å®Œæˆå¹¶å¼€å¯æ–°å‘¨æœŸ
- **æŸ¥çœ‹å†å²**ï¼šæŸ¥çœ‹å®Œæ•´çš„ä½¿ç”¨å†å²è®°å½•

#### æ™ºèƒ½å…³è”ä¸é¢„å¡«å……
- **ä¸»åŠ¨å…³è”**ï¼šç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©å…³è”çš„çˆ¶äº‹ä»¶
- **è¢«åŠ¨å…³è”**ï¼šç³»ç»Ÿæ ¹æ®äº‹ä»¶åç§°æ¨¡å¼è‡ªåŠ¨å»ºè®®å…³è”
- **é¢„å¡«å……ç­–ç•¥**ï¼šåŸºäºå†å²è®°å½•æ™ºèƒ½é¢„å¡«å……å¸¸ç”¨å­—æ®µ
- **ä¸€é”®æµè½¬**ï¼šä»æ£€æŸ¥è¿›åº¦ç›´æ¥æµè½¬åˆ°å®Œæˆè®°å½•

### æŠ€æœ¯å®ç°è¦ç‚¹

#### æ ¸å¿ƒæ–¹æ³•æ‰©å±•
- `RoutineRecord.get_active_records_by_type()` - æŒ‰ç±»å‹è·å–æ´»è·ƒè®°å½•
- `QueryResultsCard.build_workflow_buttons()` - æ„å»ºå·¥ä½œæµæŒ‰é’®
- `DirectRecordCard.build_related_record_form()` - æ„å»ºå…³è”è®°å½•è¡¨å•
- `RoutineRecord.create_related_record()` - åˆ›å»ºå…³è”è®°å½•

#### ç”¨æˆ·ä½“éªŒæµç¨‹
1. **å¼€å§‹ä½¿ç”¨**ï¼šåˆ›å»º"å¼€å§‹ä½¿ç”¨æ–°æ´—é¢å¥¶"è®°å½•
2. **å®šæœŸæ£€æŸ¥**ï¼šé€šè¿‡å·¥ä½œæµæŒ‰é’®å¿«é€Ÿè®°å½•æ£€æŸ¥ç»“æœ
3. **å®Œæˆä½¿ç”¨**ï¼šæ ‡è®°ç”¨å®Œï¼Œè‡ªåŠ¨å…³è”å†å²è®°å½•
4. **æ•°æ®åˆ†æ**ï¼šåŸºäºå…³è”è®°å½•ç”Ÿæˆä½¿ç”¨å‘¨æœŸç»Ÿè®¡

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### åµŒå¥—æ•°æ®å¤„ç†é€»è¾‘è¯´æ˜

#### safe_get_business_dataæ–¹æ³•ä½¿ç”¨è§„èŒƒ

åŸºäºé¡¹ç›®ä¸­`card_registry.py`çš„`safe_get_business_data`æ–¹æ³•å®ç°ï¼Œè¯¥æ–¹æ³•ç”¨äºå®‰å…¨åœ°ä»åµŒå¥—ä¸šåŠ¡æ•°æ®ç»“æ„ä¸­è·å–ç›®æ ‡æ•°æ®ï¼š

```python
def safe_get_business_data(
    self,
    business_data: Dict[str, Any],
    sub_business_name: str = "",
    max_depth: int = 10,
) -> Tuple[Dict[str, Any], bool]:
    """
    å®‰å…¨åœ°ä»å®¹å™¨é‡Œè·å–åˆ°è‡ªå·±ä¸šåŠ¡æ•°æ®ï¼Œæœ€å¤šé€’å½’ max_depth å±‚ã€‚
    
    å¦‚æœæä¾› sub_business_nameï¼Œåˆ™ä¸€ç›´å‘ä¸‹æŸ¥æ‰¾åŒåèŠ‚ç‚¹ï¼›
    å¦‚æœæœªæä¾›ï¼Œåˆ™ç›´æ¥å®šä½åˆ°æœ€æ·±ä¸€å±‚ sub_business_dataã€‚
    è¿”å› (data, is_container_mode)ã€‚
    """
```

**ä½¿ç”¨æ¨¡å¼ï¼š**
1. **è·å–æŒ‡å®šä¸šåŠ¡æ•°æ®**ï¼š`data_source, _ = self.parent.safe_get_business_data(business_data, CardConfigKeys.ROUTINE_RECORD)`
2. **è·å–æœ€æ·±å±‚æ•°æ®**ï¼š`data_source, is_container = self.parent.safe_get_business_data(business_data)`
3. **å®¹å™¨æ¨¡å¼æ£€æµ‹**ï¼šé€šè¿‡è¿”å›çš„`is_container_mode`åˆ¤æ–­æ˜¯å¦ä¸ºåµŒå¥—ç»“æ„

**æ•°æ®ç»“æ„è§„èŒƒï¼š**
- ä¸šåŠ¡æ•°æ®é€šè¿‡`sub_business_data`å­—æ®µåµŒå¥—
- ä¸šåŠ¡åç§°é€šè¿‡`sub_business_name`å­—æ®µæ ‡è¯†
- æ„å»ºæ–¹æ³•é€šè¿‡`sub_business_build_method`å­—æ®µæŒ‡å®š
- é¿å…ä½¿ç”¨`form_data`ç­‰éæ ‡å‡†å­—æ®µåï¼Œç»Ÿä¸€ä½¿ç”¨ä¸šåŠ¡æ•°æ®ç»“æ„

**é”™è¯¯å¤„ç†ï¼š**
- æ–¹æ³•å†…ç½®æ·±åº¦é™åˆ¶é˜²æ­¢æ— é™é€’å½’
- è¿”å›åŸå§‹æ•°æ®ä½œä¸ºé™çº§æ–¹æ¡ˆ
- é€šè¿‡`is_container_mode`æ ‡è¯†æ•°æ®è·å–çŠ¶æ€

### é›†æˆç‚¹ä¿®æ”¹
#### select_record_by_inputæ–¹æ³•ä¿®æ”¹

åœ¨`routine_cards/quick_select_card.py`çš„`select_record_by_input`æ–¹æ³•ä¸­ï¼Œå°†äº‹ä»¶ä¸å­˜åœ¨çš„å¤„ç†é€»è¾‘ä»ç®€å•æç¤ºæ”¹ä¸ºè¿›å…¥ç›´æ¥è®°å½•æ¨¡å¼ï¼š

```python
# å½“å‰é€»è¾‘ï¼ˆçº¦1185-1228è¡Œï¼‰
if definitions_data and event_name in definitions_data["definitions"]:
    # äº‹ä»¶å­˜åœ¨ï¼Œè¿›å…¥å¿«é€Ÿè®°å½•æ¨¡å¼
    # ... ç°æœ‰é€»è¾‘ä¿æŒä¸å˜
else:
    # äº‹ä»¶ä¸å­˜åœ¨ï¼Œæ”¹ä¸ºè¿›å…¥ç›´æ¥è®°å½•æ¨¡å¼
    direct_record_data = routine_business.build_direct_record_data(
        user_id, event_name
    )
    
    business_data["workflow_state"] = "direct_record"
    business_data["container_build_method"] = container_build_method
    
    parent_data, _ = self.parent.safe_get_business_data(
        business_data, parent_business_name
    )
    parent_data["sub_business_data"] = direct_record_data
    parent_data["sub_business_name"] = CardConfigKeys.ROUTINE_DIRECT_RECORD
    sub_business_build_method = self.parent.get_sub_business_build_method(
        CardConfigKeys.ROUTINE_DIRECT_RECORD
    )
    parent_data["sub_business_build_method"] = sub_business_build_method
    
    # æ›´æ–°å¡ç‰‡æ˜¾ç¤º
    new_card_dsl = self.parent.build_update_card_data(
        business_data, container_build_method
    )
    return self.parent.save_and_respond_with_update(
        context.user_id,
        card_id,
        business_data,
        new_card_dsl,
        f"å¼€å§‹ç›´æ¥è®°å½•æ–°äº‹é¡¹ ã€{event_name}ã€‘",
        ToastTypes.SUCCESS,
    )
```

### å¸¸é‡å®šä¹‰æ‰©å±•
åŸºäºç°æœ‰çš„`constants.py`ç»“æ„ï¼Œéœ€è¦åœ¨ç›¸åº”ä½ç½®æ·»åŠ ï¼š

```python
# åœ¨constants.pyçš„CardConfigKeysç±»ä¸­æ–°å¢
class CardConfigKeys:
    # ... ç°æœ‰å¸¸é‡
    ROUTINE_DIRECT_RECORD = "routine_direct_record"  # æ–°å¢ç›´æ¥è®°å½•é…ç½®é”®


# è¿›åº¦ç±»å‹å¸¸é‡ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™æ–°å¢ï¼‰
class RoutineProgressTypes:
    NONE = "none"
    VALUE = "value"
    MODIFY = "modify"

# ç›®æ ‡ç±»å‹å¸¸é‡ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™æ–°å¢ï¼‰
class RoutineTargetTypes:
    NONE = "none"
    TIME = "time"
    COUNT = "count"

```

### é…ç½®æ˜ å°„ä¿®æ”¹

éœ€è¦åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­åœ¨`CardConfigKeys.DESIGN_PLAN`å’Œ`"design_plan"`çš„å¯¹åº”ä½ç½®å¢åŠ `CardConfigKeys.ROUTINE_DIRECT_RECORD`å’Œ`"routine_direct_record"`ï¼š

1. **utils.py** (ç¬¬164è¡Œ)ï¼š
   ```python
   # ä¿®æ”¹å‰
   "card_config_key": "design_plan",
   # ä¿®æ”¹å
   "card_config_key": CardConfigKeys.ROUTINE_DIRECT_RECORD,
   ```

2. **message_handler.py** (ç¬¬367è¡Œ)ï¼š
   ```python
   # ä¿®æ”¹å‰
   card_config_key="design_plan",
   # ä¿®æ”¹å
   card_config_key=CardConfigKeys.ROUTINE_DIRECT_RECORD,
   ```

3. **card_handler.py** (ç¬¬94è¡Œ)ï¼š
   ```python
   # ä¿®æ”¹å‰
   CardConfigKeys.DESIGN_PLAN, CardConfigKeys.BILIBILI_VIDEO_INFO,
   # ä¿®æ”¹å
   CardConfigKeys.ROUTINE_DIRECT_RECORD, CardConfigKeys.BILIBILI_VIDEO_INFO,
   ```

4. **cards_operation_mapping.json** (ç¬¬25è¡Œå’Œç¬¬70è¡Œ)ï¼š
   ```json
   // ä¿®æ”¹å‰
   "card_config_key": "design_plan",
   "design_plan": {
   // ä¿®æ”¹å
   "card_config_key": "routine_direct_record",
   "routine_direct_record": {
   ```

### æ•°æ®å­˜å‚¨ç­–ç•¥

#### æ–‡ä»¶ç»“æ„
```
user_data/
â”œâ”€â”€ {user_id}/
â”‚   â”œâ”€â”€ event_definitions.json  # ç°æœ‰äº‹ä»¶å®šä¹‰
â”‚   â””â”€â”€ event_records.json      # ç°æœ‰äº‹ä»¶è®°å½•ï¼ˆåŒ…å«ç›´æ¥è®°å½•ï¼‰
```

**è¯´æ˜**ï¼šç›´æ¥è®°å½•æ•°æ®ç»§ç»­å†™å…¥ç°æœ‰çš„`event_records.json`æ–‡ä»¶ï¼Œä¸åšåŒºåˆ†å­˜å‚¨ã€‚

#### ç›´æ¥è®°å½•åœ¨event_records.jsonä¸­çš„ç»“æ„
ç›´æ¥è®°å½•æ•°æ®å°†æ·»åŠ åˆ°ç°æœ‰çš„`event_records.json`æ–‡ä»¶ä¸­ï¼Œé€šè¿‡`has_definition`å­—æ®µåŒºåˆ†ï¼š

```json
{
  "user_id": "user123",
  "records": [
    {
      "record_id": "direct_record_001",
      "event_name": "å–æ°´",
      "event_type": "instant",
      "timestamp": "2024-01-01 12:00:00",
      "completion_time": "2024-01-01 12:00:00",
      "note": "æ¸©å¼€æ°´",
      "degree": "é€‚é‡",
      "duration": 0,
      "progress_type": "value",
      "progress_value": 250,
      "check_cycle": null,
      "target_type": "none",
      "target_value": null,
      "has_definition": false,
      "created_from": "direct_input"
    }
  ]
}
```

## ğŸ“ å¼€å‘çŠ¶æ€æ€»ç»“

### âœ… å·²å®ŒæˆåŠŸèƒ½
- **åŸºç¡€æ¶æ„**ï¼šå¸¸é‡å®šä¹‰ã€é…ç½®æ˜ å°„ã€æ¨¡å—åˆå§‹åŒ–
- **è¡¨å•æ¶æ„**ï¼šåŠ¨æ€å­—æ®µæ˜¾ç¤ºã€ç±»å‹åˆ‡æ¢ã€çŠ¶æ€ä¿æŒ
- **æ‰€æœ‰äº‹ä»¶ç±»å‹**ï¼šç¬é—´å®Œæˆã€å¼€å§‹ã€é•¿æœŸé¡¹ç›®ã€æœªæ¥äº‹é¡¹
- **æ•°æ®å¤„ç†**ï¼šè¡¨å•æäº¤ã€éªŒè¯ã€è®°å½•åˆ›å»º
- **ä¸šåŠ¡é›†æˆ**ï¼šä¸ç°æœ‰ç³»ç»Ÿçš„æ— ç¼é›†æˆ

### ğŸ”„ å½“å‰å¼€å‘é‡ç‚¹

#### æ´—é¢å¥¶åœºæ™¯ä¼˜åŒ–ä»»åŠ¡
- [ ] å®ç° `OrderedDict` å­˜å‚¨ç»“æ„æ›¿æ¢ç°æœ‰åˆ—è¡¨å­˜å‚¨
- [ ] åœ¨ `query_results_card` ä¸­æ·»åŠ å·¥ä½œæµæŒ‰é’®ï¼ˆè®°å½•è¿›åº¦ã€å®Œæˆäº‹é¡¹ã€æŸ¥çœ‹å†å²ï¼‰
- [ ] å®ç°æ™ºèƒ½å…³è”æœºåˆ¶ï¼šçˆ¶å­äº‹ä»¶å…³è”ã€é¢„å¡«å……ç­–ç•¥
- [ ] å¼€å‘ä¸€é”®æµè½¬åŠŸèƒ½ï¼šä»æ£€æŸ¥è¿›åº¦åˆ°å®Œæˆè®°å½•çš„å¿«é€Ÿè½¬æ¢
- [ ] å®ç° `active_records` ç´¢å¼•å’Œå…³è”äº‹ä»¶æŸ¥æ‰¾

#### æ ¸å¿ƒæ–¹æ³•å¾…å®ç°
- [ ] `RoutineRecord.get_active_records_by_type()` - æŒ‰ç±»å‹è·å–æ´»è·ƒè®°å½•
- [ ] `QueryResultsCard.build_workflow_buttons()` - æ„å»ºå·¥ä½œæµæŒ‰é’®
- [ ] `DirectRecordCard.build_related_record_form()` - æ„å»ºå…³è”è®°å½•è¡¨å•
- [ ] `RoutineRecord.create_related_record()` - åˆ›å»ºå…³è”è®°å½•

## ğŸ”„ åç»­ä¼˜åŒ–æ–¹å‘

1. **æ•°æ®è¿ç§»å·¥å…·**ï¼šç›´æ¥è®°å½•è½¬æ¢ä¸ºäº‹ä»¶å®šä¹‰çš„å·¥å…·
2. **ç»Ÿè®¡åˆ†æ**ï¼šç›´æ¥è®°å½•çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§é‡è®°å½•çš„æŸ¥è¯¢å’Œå­˜å‚¨ä¼˜åŒ–
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæ™ºèƒ½æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½
5. **æ•°æ®åŒæ­¥**ï¼šç›´æ¥è®°å½•ä¸äº‹ä»¶å®šä¹‰è®°å½•çš„ç»Ÿä¸€ç®¡ç†

## æ€»ç»“

### ğŸ¯ é¡¹ç›®ç°çŠ¶

**ç›´æ¥è®°å½•åŠŸèƒ½**å·²å®Œå…¨å®ç°ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¾“å…¥æ¡†ä¸­ç›´æ¥è¾“å…¥æ–°äº‹é¡¹åç§°ï¼Œç³»ç»Ÿè‡ªåŠ¨è¿›å…¥ç›´æ¥è®°å½•æ¨¡å¼ï¼Œæ”¯æŒæ‰€æœ‰äº‹ä»¶ç±»å‹çš„å®Œæ•´è®°å½•åŠŸèƒ½ã€‚

### ğŸš€ ä¸‹ä¸€é˜¶æ®µç›®æ ‡

åŸºäºç”¨æˆ·æå‡ºçš„**æ´—é¢å¥¶ä½¿ç”¨è¿½è¸ªåœºæ™¯**ï¼Œæ­£åœ¨è§„åˆ’æ¶æ„ä¼˜åŒ–ï¼š

**æ ¸å¿ƒä»·å€¼**ï¼š
- è§£å†³è®¤çŸ¥è´Ÿè·ï¼šç®€åŒ–äº‹ä»¶åç§°è®¾å®šæµç¨‹
- å‡å°‘ä¿¡æ¯å™ªéŸ³ï¼šé€šè¿‡æ™ºèƒ½å…³è”å‡å°‘é‡å¤è¾“å…¥
- å®Œæ•´ä¸šåŠ¡è¿½è¸ªï¼šå®ç°çˆ¶å­äº‹ä»¶å…³è”ï¼Œå½¢æˆå®Œæ•´ä½¿ç”¨å‘¨æœŸ

**æŠ€æœ¯å®ç°**ï¼š
- æ•°æ®ç»“æ„ä¼˜åŒ–ï¼š`OrderedDict` å­˜å‚¨ï¼Œæ”¯æŒå¿«é€Ÿç´¢å¼•
- å·¥ä½œæµæŒ‰é’®ï¼šåœ¨æŸ¥è¯¢ç»“æœä¸­æä¾›å¿«é€Ÿæ“ä½œå…¥å£
- æ™ºèƒ½å…³è”ï¼šè‡ªåŠ¨è¯†åˆ«å’Œå»ºè®®ç›¸å…³äº‹ä»¶å…³è”
- ä¸€é”®æµè½¬ï¼šä»è¿›åº¦æ£€æŸ¥åˆ°å®Œæˆè®°å½•çš„æ— ç¼è½¬æ¢

### ğŸ“ å½“å‰æ–‡ä»¶ç»“æ„

- **ä¸»åè°ƒå™¨**: `routine_cards/main_coordinator.py` - è·¯ç”±å’Œåè°ƒ
- **å¿«é€Ÿé€‰æ‹©**: `routine_cards/quick_select_card.py` - äº‹ä»¶é€‰æ‹©å’Œç›´æ¥è®°å½•å…¥å£
- **è®°å½•å¡ç‰‡**: `routine_cards/record_card.py` - åŸºäºå®šä¹‰çš„è®°å½•åŠŸèƒ½
- **ç›´æ¥è®°å½•**: `routine_cards/direct_record_card.py` - âœ… å·²å®Œæˆçš„ç›´æ¥è®°å½•åŠŸèƒ½
- **æŸ¥è¯¢ç»“æœ**: `routine_cards/query_results_card.py` - ğŸ”„ å¾…ä¼˜åŒ–çš„å·¥ä½œæµæŒ‰é’®
- **ä¸šåŠ¡é€»è¾‘**: `Services/routine_record.py` - âœ… å·²å®Œæˆæ ¸å¿ƒä¸šåŠ¡æ–¹æ³•

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**åˆ›å»ºæ—¶é—´**ï¼š2024-01-01  
**æœ€åæ›´æ–°**ï¼š2025-07-22  
**çŠ¶æ€**ï¼šç›´æ¥è®°å½•åŠŸèƒ½å·²å®Œæˆï¼Œæ´—é¢å¥¶åœºæ™¯ä¼˜åŒ–è§„åˆ’ä¸­