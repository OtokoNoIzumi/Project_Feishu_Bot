---
description:
globs:
alwaysApply: true
---
---
description: 处理飞书机器人项目的架构规范指令
globs:
alwaysApply: false
---
1. **配置服务架构规范**：
   - 项目基于conda虚拟环境，配置服务必须正确处理项目根路径
   - 配置优先级：环境变量(.env) > 静态配置(config.json)
   - 所有配置文件路径解析都要基于项目根路径，不依赖工作目录

2. **代码修改原则**：
   - 每次修改前必须充分理解现有业务逻辑和文件依赖
   - 不能为了解决一个问题而引入新问题
   - 如果验证失败，应该停止尝试，等待用户指导，而不是继续试错

3. **架构层级规范**：
## 1+3层架构定义
0. **应用控制层（容器）** (Application): 服务编排、生命周期管理
1. **适配器层** (Adapters): 飞书协议转换、事件处理
2. **业务逻辑层** (Business): 消息路由、业务规则处理
3. **服务层** (Services): 具体功能实现、数据持久化

## 数据流向约束
- **向下调用**: 除了容器层外，上层可调用下层服务，禁止下层依赖上层
- **层次隔离**: 业务层不得直接访问适配器层，必须通过应用控制层
- **配置驱动**: 卡片与业务通过配置文件桥接，避免硬编码依赖

